---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL;
const posts = (await getCollection("diary"))
  .filter(p => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---
<BaseLayout title="Posts — John">
  <section>
    <div class="section-head">
      <div>
        <h2 class="reveal">All posts</h2>
        <p class="sub reveal">Everything I’ve written so far.</p>
      </div>
    </div>

    <div class="grid">
      <div class="diary reveal">
        {posts.map((post) => (
          <a class="entry" href={`${base}posts/${post.id}/`}>
            <div class="date">{post.data.pubDate.toISOString().slice(0,10)}</div>
            <div>
              <b>{post.data.title}</b>
              <span>{post.data.description}</span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>
