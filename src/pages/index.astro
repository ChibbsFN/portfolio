---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const diaryEntries = (await getCollection("diary", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const featuredProjects = (await getCollection("projects"))
  .filter((p) => p.data.featured)
  .slice(0, 3);
---

<BaseLayout title="John in Vantaa â€” diary + portfolio" description="Minimal diary, portfolio, and life in Finland.">
  <div class="container">
    <div class="grid two">
      <section class="card">
        <div class="kicker">Minimal diary â€¢ Portfolio â€¢ Life in Finland</div>
        <h1>John in Vantaa.</h1>
        <p class="lead">
          I live in <strong>Vantaa, Finland</strong>. This is my small corner of the internet:
          a calm diary of everyday life + a portfolio of what I build.
        </p>

        <div class="pillrow">
          <span class="pill">ğŸ“ Vantaa</span>
          <span class="pill">ğŸ‡«ğŸ‡® Finland</span>
          <span class="pill">â˜• coffee walks</span>
          <span class="pill">ğŸŒ² forests</span>
          <span class="pill">ğŸ§  learning</span>
        </div>

        <div class="hr"></div>

        <div style="display:flex; gap:10px; flex-wrap: wrap;">
          <a class="btn primary" href={`${import.meta.env.BASE_URL}work/`}>View portfolio</a>
          <a class="btn" href={`${import.meta.env.BASE_URL}diary/`}>Read the diary</a>
          <a class="btn" href={`${import.meta.env.BASE_URL}photos/`}>See photos</a>
        </div>

        <h2>Latest diary entries</h2>
        <p class="lead">Short notes you can read in 2â€“3 minutes.</p>

        <ul class="list">
          {diaryEntries.map((e) => (
            <li>
              <a class="item" href={`${import.meta.env.BASE_URL}diary/${e.slug}/`}>
                <div class="item__top">
                  <span class="item__title">{e.data.title}</span>
                  <span class="item__meta">{e.data.pubDate.toISOString().slice(0,10)}</span>
                </div>
                <div class="item__desc">{e.data.description ?? ""}</div>
              </a>
            </li>
          ))}
        </ul>

        <div class="hr"></div>

        <h2>Featured projects</h2>
        <p class="lead">A few things Iâ€™m proud of. (More on the Portfolio page.)</p>

        <ul class="list">
          {featuredProjects.length ? featuredProjects.map((p) => (
            <li>
              <a class="item" href={`${import.meta.env.BASE_URL}work/${p.slug}/`}>
                <div class="item__top">
                  <span class="item__title">{p.data.title}</span>
                  <span class="item__meta">{p.data.stack?.slice(0,2).join(" â€¢ ")}</span>
                </div>
                <div class="item__desc">{p.data.description}</div>
              </a>
            </li>
          )) : (
            <li class="item">
              <div class="item__top"><span class="item__title">Add your first project</span><span class="item__meta">Portfolio</span></div>
              <div class="item__desc">Go to <code>src/content/projects</code> and add a Markdown file.</div>
            </li>
          )}
        </ul>
      </section>

      <aside class="card">
        <div class="portrait">
          <img class="portrait__img" src={`${import.meta.env.BASE_URL}your-photo.jpg`} alt="John portrait" loading="lazy" />
          <div class="portrait__meta">
            <span class="badge">ğŸ“ Vantaa</span>
            <span class="badge">Updated: {new Date().toISOString().slice(0,10)}</span>
          </div>
        </div>

        <div style="height: 14px;"></div>

        <div class="card soft">
          <h2 style="margin-top:0;">A quick â€œNowâ€</h2>
          <p class="lead">
            Building a better routine for winter, writing small notes, and keeping life simple.
          </p>
          <a class="btn" href={`${import.meta.env.BASE_URL}now/`}>Open Now page</a>
        </div>

        <div style="height: 14px;"></div>

        <div class="card soft">
          <h2 style="margin-top:0;">Editing content</h2>
          <p class="lead">
            You can edit posts and projects as Markdown files in GitHub. Optional admin UI is at <code>/admin</code>.
          </p>
          <a class="btn" href={`${import.meta.env.BASE_URL}admin/`}>Open editor</a>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
